name: Supabase Heartbeat

on:
  schedule:
    # Понедельник и четверг в 10:00 UTC
    - cron: '0 10 * * 1,4'
  workflow_dispatch: # Ручной запуск

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase
        run: |
          # Простой запрос к RPC функции чтобы база не засыпала
          curl -s -X POST \
            "${{ secrets.VITE_SUPABASE_URL }}/rest/v1/rpc/share_get" \
            -H "apikey: ${{ secrets.VITE_SUPABASE_ANON_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{"share_id": "00000000-0000-0000-0000-000000000000", "share_secret": "ping"}' \
            || true
          echo "Heartbeat sent to Supabase"

Ок, план под **Supabase**, и честный разбор рисков “будет ли работать / бесплатно / не исчезнет”.

---

## План внедрения Supabase для “поделиться настройками”

### 1) Проект и лимиты (сразу закладываем рамки)

* Создаём **1 проект Supabase (Free)**, выбираем регион поближе к РФ/Европе (для задержек). ([Supabase][1])
* Free-лимиты: **500 MB база**, **1 GB file storage**, **5 GB egress + 5 GB cached egress**, **до 50k MAU**. ([Supabase][2])
  Твой “текстовый максимум” сейчас крошечный, так что в лимиты влезает с огромным запасом.

### 2) Схема данных

Таблица `shared_configs`:

* `id uuid pk`
* `secret_hash text` (храним **хеш**, не секрет в чистом виде)
* `payload jsonb`
* `created_at timestamptz default now()`
* `expires_at timestamptz` (пусть будет, даже если TTL “минимум сутки”)

Индекс по `expires_at` (для чистки), возможно по `created_at`.

### 3) Безопасность (чтобы не было “публичного списка всех конфигов”)

* Включаем **RLS**.
* **Запрещаем прямой SELECT/INSERT** для `anon`.
* Делаем 2 RPC-функции (Postgres functions):

  1. `share_create(payload)` → создаёт запись, генерит `id`, `secret`, кладёт `secret_hash`, выставляет `expires_at` (например, `now()+7 days`), возвращает `id` и `secret`
  2. `share_get(id, secret)` → сверяет хеш и `expires_at`, возвращает `payload` или ошибку

И выдаём `anon` только право **EXECUTE** этих функций.

### 4) Генерация ссылки

* Ссылку формируем как `https://site/#share=<id>.<secret>`
  Секрет лучше держать во **fragment** (`#...`), чтобы он меньше “светился” в логах/проксах.

### 5) Картинки отдельно

Ты сам сказал “картинки могут быть сильно больше” — значит:

* Либо Supabase Storage (но лимит **1GB на Free**). ([Supabase][2])
* Либо внешний image hosting (если доступность/цены устраивают).
  В payload храним только URL картинок.

### 6) Очистка (TTL)

Раз тебе важно “хотя бы сутки”, а не строго 24ч:

* Ставь `expires_at` хотя бы **7 дней** — меньше головняка и меньше шанс, что пользователь “опоздал на час”.
* Чистку можно сделать:

  * *ленивой*: `share_get` при обращении удаляет просроченные записи
  * или *периодической*: GitHub Actions по cron раз в день удаляет `expires_at < now()` (ключ service role хранится в GitHub Secrets)

### 7) Чтобы проект не “уснул” на Free

На Free проекты **паузятся после 1 недели низкой/нулевой активности**. ([Supabase][2])
Если у тебя будут реальные пользователи — он сам не уснёт. Если трафик редкий — ставим GitHub Actions “heartbeat” 2 раза в неделю (просто SELECT/RPC вызов). Это стандартный обход. ([AWS in Plain English][3])

### 8) Бэкапы (важно для “не удалится?”)

На Free **бэкапы не доступны для скачивания из Dashboard**. ([Supabase][4])
А ещё есть важная штука: если проект **в паузе**, есть **окно 90 дней на восстановление**. ([Supabase][5])
И в сообществе есть реальные кейсы, когда после долгой паузы люди сталкивались с потерей данных (неофициальные источники, но игнорировать нельзя). ([Reddit][6])

Поэтому, если для тебя “не исчезнет” критично:

* делаем **pg_dump бэкап через GitHub Actions** раз в день/неделю и складываем как зашифрованный artifact/релиз (или в приватный репозиторий). Это без VPS.

---

## Ответы на твои вопросы

### “Точно будет работать?”

Функционально — да: архитектура с RPC + fragment-секретом нормальная и масштабируется под твой кейс.

Но есть 2 внешних риска:

1. **Доступность Supabase из РФ**: иногда у людей бывает, что **supabase.com / dashboard** открывается только через VPN (есть жалобы). ([GitHub][7])
   Важно: это не всегда означает, что **API проекта** будет недоступно, но риск есть.
2. Любой внешний провайдер может попасть под блокировки/деградации.

Как страхуемся:

* делаем быстрый “смоук-тест” из РФ/у знакомых в РФ: открыть твой GH Pages + сделать 1 share + 1 load.
* держим **fallback**: если Supabase недоступен, можно хотя бы **тексты** временно шарить через `#cfg=...` (у тебя тексты маленькие).

### “Бесплатно?”

Да, **$0**, пока ты в лимитах Free (500MB DB, 1GB storage, egress и т.д.). ([Supabase][2])
Как только начнётся реальный прод-трафик/много картинок/много выгрузки — можно упереться в egress/storage.

### “Не удалится?”

Гарантии “никогда” на Free нет.

* Проект могут **поставить на паузу** при низкой активности через ~7 дней. ([Supabase][2])
* У паузы есть **окно восстановления 90 дней**. ([Supabase][5])
* Бэкапы на Free не даются “из коробки”. ([Supabase][4])

Если сделать **heartbeat + регулярный pg_dump**, то для твоей задачи это будет практически “неубиваемо” без VPS.

---

Если хочешь — я следующим сообщением дам “скелет” решения (структура таблицы + логика 2 RPC + как именно должен вести себя фронт) **без кода**, но максимально конкретно, чтобы можно было отдать разработчику и он за вечер собрал.

[1]: https://supabase.com/docs/guides/platform/regions?utm_source=chatgpt.com "Available regions | Supabase Docs"
[2]: https://supabase.com/pricing?utm_source=chatgpt.com "Pricing & Fees"
[3]: https://aws.plainenglish.io/how-to-keep-supabase-free-tier-projects-active-d60fd4a17263?utm_source=chatgpt.com "Prevent Supabase Free Tier Pausing (2026 Guide) | Medium"
[4]: https://supabase.com/docs/guides/deployment/going-into-prod?utm_source=chatgpt.com "Production Checklist | Supabase Docs"
[5]: https://supabase.com/docs/guides/platform/upgrading?utm_source=chatgpt.com "Upgrading | Supabase Docs"
[6]: https://www.reddit.com/r/Supabase/comments/zwx378/i_lost_all_of_my_data_after_the_supabase_pause/?utm_source=chatgpt.com "I lost all of my data after the Supabase pause period!!"
[7]: https://github.com/supabase/supabase/issues/35922?utm_source=chatgpt.com "Supabase.com inaccessible unless using VPN #35922"


-----------------------------------------
Ниже — “скелет” решения, чтобы ты мог отдать это в ClaudeCode и быстро собрать без лишних обсуждений.

---

## Цель

Статический фронт (GitHub Pages) делает:

* **Share**: загружает JSON настроек, получает короткую ссылку
* **Load by link**: по ссылке получает JSON и восстанавливает конфиг

Без логина. Без VPS. Без “публичного списка” всех шар.

---

## 1) Модель данных в Supabase

### Таблица `shared_configs`

Поля:

* `id` UUID (PK)
* `secret_hash` TEXT (храним **хеш**, не секрет)
* `payload` JSONB (тексты/настройки; **без base64 картинок**, только URL)
* `created_at` TIMESTAMPTZ default now()
* `expires_at` TIMESTAMPTZ (например now()+7 days)
* (опционально) `ip_hash` TEXT / `ua_hash` TEXT — если захочешь анти-спам/аудит без хранения IP в чистом виде
* (опционально) `version` INT — если формат payload будет меняться

Индексы:

* индекс по `expires_at`
* индекс по `created_at` (не обязателен, но удобно)

---

## 2) Безопасность: RLS + только RPC

### Политика “прямых” операций

* Включить **RLS** на таблице
* Для роли `anon`:

  * **запретить** прямой `SELECT/INSERT/UPDATE/DELETE` на таблицу
  * разрешить **только вызов** функций (RPC)

Смысл: даже если кто-то знает URL твоего Supabase, он **не сможет** листать данные или делать “select *”.

---

## 3) Две RPC-функции (вся логика доступа)

### `share_create(payload_json)`

Что делает:

1. Валидация payload:

   * максимальный размер (например 200KB для текста — на вырост)
   * обязательные поля/версия
2. Генерит:

   * `id = uuid`
   * `secret = криптографически случайная строка` (длина 24–32 байта в base64url, либо 32–48 hex)
3. `secret_hash = hash(secret + server_salt)`
   (или хотя бы `hash(secret)`; соль лучше держать на стороне БД/в функции)
4. Пишет строку с `expires_at = now() + interval '7 days'` (или 1 day если хочешь прям “сутки”)
5. Возвращает **`id` и `secret`**

Права: `anon` может EXECUTE `share_create`.

> Почему так: секрет не хранится в базе в чистом виде, а доступ идёт “по знанию секрета”.

### `share_get(id, secret)`

Что делает:

1. Находит строку по `id`
2. Проверяет:

   * `expires_at > now()`
   * `secret_hash` совпадает с `hash(secret + salt)`
3. Возвращает `payload` (или ошибку “not found/expired” без уточнений)

Права: `anon` может EXECUTE `share_get`.

> Важно: ответы лучше делать одинаковыми по смыслу (“не найдено”), чтобы не помогать угадывать существующие `id`.

---

## 4) Формат ссылки (чтобы не светить секрет лишний раз)

Ссылка на GH Pages:

* `https://your-site/#share=<id>.<secret>`

Почему `#`:

* fragment не уходит на сервер при запросах страницы
* меньше следов в логах/превьюшках

---

## 5) Поведение фронта

### Flow “Поделиться”

1. Собрать `payload`:

   * тексты/правила/настройки
   * **картинки уже должны быть URL**, не base64
2. (Опционально) сжать JSON перед отправкой — не обязательно при твоих размерах
3. Вызвать Supabase RPC `share_create(payload)`
4. Собрать ссылку `#share=id.secret`
5. Скопировать в буфер / показать QR / “поделиться”

### Flow “Открыть ссылку”

1. При загрузке страницы:

   * если есть `#share=...` → распарсить `id` и `secret`
2. Вызвать RPC `share_get(id, secret)`
3. Восстановить UI из `payload`
4. Если “expired/not found” — показать дружелюбное сообщение + кнопка “очистить ссылку”

---

## 6) TTL и очистка (минимум сутки)

Раз у тебя требование “хотя бы сутки”, предлагаю:

* `expires_at = now()+7 days` (юзер не опоздает)
* очистка:

  * **ленивая**: `share_get` при обращении может удалять/игнорировать просроченное
  * **периодическая**: GitHub Actions cron раз в день вызывает “cleanup RPC” (или SQL через service role)

Минимально достаточно ленивой (данных мало). Если хочется порядка — делай cron.

---

## 7) Анти-спам (чтобы тебя не зафлудили)

Минимальный набор:

* В `share_create`:

  * лимит размера payload
  * лимит частоты: например, не больше N записей за X минут на `ip_hash` (можно хешировать `request.ip` внутри функции если доступно; если нет — ставь “глобальный” лимит на уровне приложения: localStorage cooldown + Supabase rate limits/ограничения)
* Ошибки: всегда одинаковые по тексту (“не удалось создать”), без деталей.

Если у проекта публичная аудитория — это важно.

---

## 8) Доступность из РФ и “не удалится ли”

### Что реально может случиться на Free

* Проект может “засыпать” при низкой активности (тогда проснётся при обращении, но это неприятно)
* Никаких “вечных гарантий” нет у любого free-tier провайдера

### Практический план страховки без VPS

1. **Heartbeat** (GitHub Actions 2 раза в неделю):

   * простой вызов `share_get` с несуществующим id (или отдельный `ping` RPC)
   * цель: не дать проекту простаивать месяцами
2. **Fallback режим**:

   * если Supabase не отвечает, ты можешь всё равно шарить **только тексты** прямо в `#cfg=` (сжатый JSON) — как аварийный режим.
   * это решает “а вдруг провайдер лег/режется”.

---

## 9) Acceptance criteria (чеклист “готово”)

* [ ] Без ссылки на Supabase нельзя прочитать никакие записи (нет public SELECT)
* [ ] По `id` без `secret` ничего не отдается
* [ ] Ссылка открывается и восстанавливает конфиг
* [ ] Просроченная ссылка показывает “истекло”
* [ ] Payload лимитируется по размеру (защита от мусора)
* [ ] Создание ограничено по частоте (хотя бы примитивно)
* [ ] Есть heartbeat (или ты точно уверен, что проект будет регулярно использоваться)

---
# Контекст: Функция "Поделиться" (Share Feature)

## Цель
Реализовать функцию публичной ссылки для шаринга конфигураций бота между пользователями.

**Use case:**
- Клиент заполняет форму настройки бота
- Нажимает "Поделиться"
- Получает публичную ссылку
- Отправляет ссылку мне
- Я открываю ссылку и вижу его конфигурацию для проверки перед созданием реального бота

## Требования
1. **Доступность из России** - критически важно, т.к. проект на GitHub Pages
2. **Поддержка больших данных** - в конфигурации могут быть 2 картинки в base64:
   - Avatar (до ~100KB в base64)
   - Bot Picture (до ~500KB в base64)
   - Общий размер данных может быть **~600-700KB**
3. **Temporary storage** - данные нужны на 24 часа, потом можно удалять
4. **Без авторизации** - должно работать для анонимных пользователей

## Попытка 1: JSONBin.io

### Почему выбрали JSONBin
- Бесплатный план
- Простой REST API
- Не требует OAuth
- Обещает работать из России

### Что делали
1. Зарегистрировались на jsonbin.io
2. Получили X-Master-Key API ключ
3. Добавили в .env файл: `VITE_JSONBIN_API_KEY=...`
4. Реализовали функцию `handleShare()` в [src/App.tsx:642-706](src/App.tsx#L642-L706)
5. Использовали endpoint: `POST https://api.jsonbin.io/v3/b`

### Проблемы
**Ошибка 401 Unauthorized** - постоянно возвращается при попытке создать bin

**Попытки решения:**
1. ✗ Проверили формат API ключа - копировали напрямую через кнопку
2. ✗ Перегенерировали новый ключ
3. ✗ Перезапускали dev server для перезагрузки .env
4. ✓ Изучили документацию API: https://jsonbin.io/api-reference/bins/create

### Что узнали из документации
**Обязательные заголовки:**
```javascript
{
  'Content-Type': 'application/json',
  'X-Master-Key': '<API_KEY>'
}
```

**Критическое ограничение:**
> **Free tier limit: Cannot exceed 100kb**

**Проблема:** Наши данные с картинками в base64 = **~600-700KB** → JSONBin не подходит!

### Причины отказа от JSONBin
1. **Лимит 100KB на бесплатном плане** - мы не влезаем с картинками
2. **401 ошибка** - возможно у Master Key нет permissions "Bins Create"
3. **Неясная причина ошибки** - даже после N попыток с правильными ключами

## Альтернативные решения (нужно исследовать)

### Вариант 1: GitHub Gist API
- ✓ Поддерживает анонимные gists
- ✓ Лимит до 100MB
- ✓ Бесплатно
- ? Работает ли из России

### Вариант 2: URL Compression (LZ-String + Base64)
- ✓ Без backend
- ✓ Работает везде
- ✗ Ограничение URL (~2000 символов после сжатия)
- ✗ Не подходит для больших картинок

### Вариант 3: Pastebin / PasteBin.pl
- ✓ Большие лимиты
- ? Нужна регистрация?
- ? Работает из России?

### Вариант 4: Собственный serverless endpoint
- Cloudflare Workers → не работает из России
- Vercel Edge Functions → ?
- Netlify Functions → ?

## Рекомендация для следующей сессии

**ВАЖНО:** Перед выбором нового сервиса:
1. Проверить лимиты на размер данных (нужно минимум 1MB)
2. Проверить доступность из России
3. Изучить актуальную документацию API
4. Проверить не требуется ли OAuth

**Приоритет решений:**
1. GitHub Gist (если работает из России)
2. Альтернативные paste-сервисы с большими лимитами
3. В крайнем случае - отказаться от картинок в share-ссылке (только текстовые поля)

## Текущее состояние кода

Файлы с изменениями:
- `src/App.tsx` - функция `handleShare()` готова, нужно только поменять backend
- `.env` - содержит VITE_JSONBIN_API_KEY (можно удалить)
- `.env.example` - инструкции для JSONBin (нужно обновить)
- `.gitignore` - правильно настроен для .env файлов

UI полностью готов:
- Кнопка "Поделиться" с spinner
- Loading state (isSharing)
- Toast уведомления
- Копирование ссылки в буфер обмена



----------------------------------------------
Ок. Логика такая: мы выбирали не “идеальное”, а **самое предсказуемое** под твои ограничения: статик (GH Pages), без VPS, анонимно, работает из РФ, не ломается от лимитов/блокировок/сюрпризов.

## Почему отмели остальные варианты

### 1) “Текст в URL” как основное хранилище

**Почему не как основной путь:**

* Пока твои тексты маленькие — ок. Но это **хрупкая схема**: растёт payload → растёт ссылка → начинаются рандомные отрезания/поломки в мессенджерах, превью, прокси и т.д.
* И UX страдает (длинные ссылки, сложно шарить/копировать, иногда портятся).

**Где годится:** как **fallback/аварийный режим** (и мы его оставляем как запасной выход).

---

### 2) Public file-hosting (0x0.st, paste-сервисы, “залил файл → вот URL”)

**Почему не выбрали:**

* **TTL не контролируешь**. Тебе “минимум сутки” — это ок, но появляется другая проблема: может жить **слишком долго**, а ты не можешь гарантированно удалить.
* Доступность/стабильность/правила могут меняться. Сегодня работает, завтра лимит/бан/капча/блок.
* Это публичное хранилище. Если когда-нибудь в конфиге окажется что-то чувствительное — придётся **шифровать** на клиенте, иначе беда.

**Где годится:** как “быстрый прототип” или запасной вариант, если вообще всё остальное упало.

---

### 3) Telegraph

**Почему отмели:**

* Это по сути публикация страницы. Там нет нормального TTL/удаления “через сутки”.
* Плюс это не “хранилище произвольного JSON больших размеров” и не про приватность.
* Итог: слишком много несоответствий твоему сценарию.

---

### 4) GitHub Gist / GitHub как storage

**Почему отмели:**

* Нормально создать gist “анонимно с фронта” нельзя: нужен токен → токен на фронте нельзя.
* Делать через GitHub Actions можно, но это уже “почти бэкенд”, и всё равно публичность/удаление/права — головняк.

---

### 5) JSONBin / подобные “JSON storage as a service”

**Почему отмели:**

* У тебя текст уже ок, но как только добавятся данные/рост — ты упрёшься в лимиты free-tier (у JSONBin это прям явно).
* Плюс часто требуется ключ, и опять вопрос: как не светить ключ на статике.

---

### 6) Cloudflare Workers + KV

**Почему отмели:**

* Критический фактор: **Cloudflare/Pages у тебя из РФ не доступен** → вся CF-линейка становится рискованной/неприемлемой независимо от того, какая она красивая технически.

---

## Какие “нормальные” варианты ещё остаются, но мы их не выбрали

### A) Firebase / Firestore (или другой BaaS)

**Нормальный вариант**, потому что тоже “без VPS”, есть правила доступа, можно сделать ссылку-ключ.
**Почему не выбрали:**

* Сложнее модель безопасности/правил, чуть больше магии и вероятность “случайно открыли чтение всем”.
* Доступность из РФ и политика/блокировки — отдельный риск (и это не так прозрачно, как хочется).
* По сути это тот же класс решения, что Supabase, но обычно менее приятен для “хочу просто положить JSON по ключу”.

### B) S3-совместимое хранилище с pre-signed URL (Backblaze B2 / Wasabi / etc.)

**Сильный вариант**: дешево, надёжно, можно TTL на ссылку.
**Почему не выбрали:**

* На статике тебе всё равно нужен компонент, который будет подписывать URL (секрет нельзя на фронт) → либо функции/сервер/экшен.
* То есть инфраструктуры получается больше, чем Supabase.

### C) “Свой маленький backend” на serverless-платформе, не Cloudflare (Deno Deploy, Fly.io, Render, Railway, Vercel/Netlify Functions)

**Технически нормальный путь**: 2 эндпоинта + Redis/SQLite/память + TTL.
**Почему не выбрали:**

* Ты прямо сказал: **не хочу разворачивать свой VPS/бэк**.
* Плюс вопрос доступности из РФ для конкретной платформы тоже надо проверять.

### D) Полностью клиентское шифрование + любой публичный storage

**Нормально**, если боишься утечек: шифруешь payload (AES-GCM), ключ в `#fragment`, а данные кладёшь хоть на 0x0/jsonblob.
**Почему не выбрали:**

* Это добавляет крипто-слой и усложняет дебаг/UX.
* И остаётся нестабильность самого публичного storage.

---

## Почему Supabase в итоге победил

* Это BaaS без VPS, но с **нормальной базой и контролем доступа**.
* Можно сделать **анонимный share** без “публичного списка” через RPC.
* Масштабируется: сегодня 2KB текста, завтра 200KB — всё равно живёт.
* TTL можно сделать мягкий (сутки/неделя) без боли.
* И это один сервис, без “картинки тут, JSON там, текст в URL ещё где-то”.

Если хочешь, могу коротко сформулировать для команды **“критерии выбора”** в 5–7 строк (как в decision record), чтобы потом никто не начинал снова предлагать Telegraph/0x0 “а давайте проще”.
